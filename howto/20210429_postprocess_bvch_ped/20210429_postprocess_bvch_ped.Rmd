---
title: "Postprocessing BVCH Pedigree"
author: "Peter von Rohr"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Disclaimer
The PopReport results for the BVCH pedigree are postprocessed. 


# Project
The project name is found by 

```
psql -U postgres -d GenMon_CH -c "SELECT datname FROM pg_database where datname like 'PPP%';"
```

From the poprep output, we know that the project name is `PPP_sOIJi5jOrPpzw`


# Tables with PopRep Results
Tables created by PopRep

```
PRPPROJ=PPP_sOIJi5jOrPpzw
psql -U postgres -d $PRPPROJ -c "select * from pg_catalog.pg_tables where tableowner = 'apiis_admin';"
```


# Breed ID
How do we have to determine the breed ID

```
psql -U postgres -d GenMon_CH -c "select * from codes"
```

which is still empty.

Content of species table

```
psql -U postgres -d GenMon_CH -c "select * from species"
```

still empty.

Weights

```
psql -U postgres -d GenMon_CH -c "select * from thres_weight"
```

default weights are found.

# Summary

```
psql -U postgres -d GenMon_CH -c "select * from summary"
```


# Postprocessing

Run php from command line

```
cd /home/gnmzws/source/GENMON
php -f PostprocessPopRep.php
```

Output produces

```
PHP Warning:  pg_fetch_result(): Unable to jump to row 0 on PostgreSQL result index 9 in /home/gnmzws/source/GENMON/PostprocessPopRep.php on line 39
ERROR:  schema "apiis_admin" does not exist
LINE 1: CREATE TABLE apiis_admin.tmp2_table3 (
                     ^
ERROR:  schema "apiis_admin" does not exist
ERROR:  schema "apiis_admin" does not exist
invalid command \N
invalid command \N
invalid command \N
invalid command \N
invalid command \.
ERROR:  syntax error at or near "119"
LINE 1: 119 1923 1 0.0000 0.0000 0.0000
        ^
PHP Warning:  pg_query(): Query failed: ERROR:  schema "apiis_admin" does not exist in /home/gnmzws/source/GENMON/PostprocessPopRep.php on line 90
PHP Warning:  pg_query(): Query failed: ERROR:  relation "tmp2_table3" does not exist in /home/gnmzws/source/GENMON/PostprocessPopRep.php on line 94
PHP Warning:  Cannot modify header information - headers already sent by (output started at /home/gnmzws/source/GENMON/logger.php:56) in /home/gnmzws/source/GENMON/PostprocessPopRep.php on line 101
```

Find schemas in DB

```
psql -U postgres -d GenMon_CH -c "SELECT schema_name FROM information_schema.schemata"
psql -U geome_admin -d GenMon_CH -c "SELECT schema_name FROM information_schema.schemata"
```

Create new schema

```
psql -U geome_admin -d GenMon_CH -c "CREATE SCHEMA IF NOT EXISTS apiis_admin"
psql -U geome_admin -d GenMon_CH -c "SELECT schema_name FROM information_schema.schemata"
```

Check codes

```
psql -U geome_admin -d GenMon_CH -c "select * from codes"
 db_code | short_name | ext_code |        class         |                     long_name                      
---------+------------+----------+----------------------+----------------------------------------------------
     131 | BV2000     |          | BREED                | Braunvieh2000                   
```



Insert codes

```
psql -U geome_admin -d GenMon_CH -c "insert into codes (db_code, short_name, class, long_name) values(6, 'BV', 'BREED', 'Braunvieh' "
```



